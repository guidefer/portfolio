<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Section Detection Debug</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #f0f0f0;
        }
        
        .debug-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-panel h3 {
            margin-top: 0;
            color: #333;
        }
        
        .section-info {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #EBC533;
        }
        
        .found {
            border-left-color: #28a745;
        }
        
        .not-found {
            border-left-color: #dc3545;
        }
        
        .test-btn {
            margin: 5px;
            padding: 8px 16px;
            background: #EBC533;
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .test-btn:hover {
            background: #D66422;
            color: white;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h3>üîç Section Detection Debug</h3>
        <div id="main-site-info">
            <p>Loading main site info...</p>
        </div>
        <button class="test-btn" onclick="reloadMainSite()">Reload Main Site</button>
        <button class="test-btn" onclick="checkSections()">Check Sections</button>
    </div>
    
    <div class="debug-panel">
        <h3>üìã Section Analysis</h3>
        <div id="section-analysis">
            <p>Click "Check Sections" to analyze...</p>
        </div>
    </div>
    
    <script>
        let mainSiteWindow = null;
        
        function reloadMainSite() {
            if (mainSiteWindow && !mainSiteWindow.closed) {
                mainSiteWindow.close();
            }
            
            mainSiteWindow = window.open('../../index.html', '_blank');
            
            setTimeout(() => {
                if (mainSiteWindow && !mainSiteWindow.closed) {
                    checkSections();
                }
            }, 1000);
        }
        
        function checkSections() {
            const infoDiv = document.getElementById('main-site-info');
            const analysisDiv = document.getElementById('section-analysis');
            
            if (!mainSiteWindow || mainSiteWindow.closed) {
                infoDiv.innerHTML = '<p style="color: red;">‚ùå Main site not open. Click "Reload Main Site" first.</p>';
                return;
            }
            
            try {
                const doc = mainSiteWindow.document;
                
                // Check for sections using the same selectors as mascot.js
                const sectionSelectors = [
                    '#home',
                    '#work', 
                    '#about',
                    '#contact',
                    '.hero-section',
                    '.gallery-section',
                    '.about-section',
                    '.contact-section'
                ];
                
                let analysis = '<h4>üîç Section Detection Results:</h4>';
                let foundSections = [];
                
                sectionSelectors.forEach(selector => {
                    const elements = doc.querySelectorAll(selector);
                    const found = elements.length > 0;
                    
                    analysis += `<div class="section-info ${found ? 'found' : 'not-found'}">`;
                    analysis += `<strong>${selector}:</strong> `;
                    analysis += found ? `‚úÖ Found ${elements.length} element(s)` : '‚ùå Not found';
                    
                    if (found) {
                        Array.from(elements).forEach((el, i) => {
                            const rect = el.getBoundingClientRect();
                            const visible = rect.top < window.innerHeight && rect.bottom > 0;
                            
                            analysis += `<br>  ‚Ä¢ Element ${i + 1}: ${el.tagName.toLowerCase()}`;
                            if (el.id) analysis += ` id="${el.id}"`;
                            if (el.className) analysis += ` class="${el.className}"`;
                            analysis += ` (${visible ? 'visible' : 'not visible'})`;
                            analysis += ` - Top: ${rect.top.toFixed(0)}px, Height: ${rect.height.toFixed(0)}px`;
                            
                            foundSections.push({
                                selector,
                                element: el,
                                rect,
                                visible
                            });
                        });
                    }
                    analysis += '</div>';
                });
                
                // Overall query test
                const allSections = doc.querySelectorAll('#home, #work, #about, #contact, .hero-section, .gallery-section, .about-section, .contact-section');
                
                analysis += `<div class="section-info ${allSections.length > 0 ? 'found' : 'not-found'}">`;
                analysis += `<strong>Combined Query:</strong> Found ${allSections.length} total sections`;
                analysis += '</div>';
                
                // Check if mascot exists
                const mascotExists = mainSiteWindow.mascot !== undefined;
                const mascotType = mascotExists ? typeof mainSiteWindow.mascot : 'undefined';
                
                analysis += `<div class="section-info ${mascotExists ? 'found' : 'not-found'}">`;
                analysis += `<strong>Mascot Instance:</strong> ${mascotExists ? '‚úÖ Available' : '‚ùå Not found'} (type: ${mascotType})`;
                analysis += '</div>';
                
                if (mascotExists && mainSiteWindow.mascot.triggerContextualAnimation) {
                    analysis += '<div class="section-info found">';
                    analysis += '<strong>Manual Tests:</strong><br>';
                    analysis += '<button class="test-btn" onclick="testContextualAnimation(\'hero\')">Test Hero</button>';
                    analysis += '<button class="test-btn" onclick="testContextualAnimation(\'work\')">Test Work</button>';
                    analysis += '<button class="test-btn" onclick="testContextualAnimation(\'about\')">Test About</button>';
                    analysis += '<button class="test-btn" onclick="testContextualAnimation(\'contact\')">Test Contact</button>';
                    analysis += '</div>';
                }
                
                analysisDiv.innerHTML = analysis;
                infoDiv.innerHTML = `<p style="color: green;">‚úÖ Main site loaded and accessible</p>`;
                
                console.log('üîç Found sections:', foundSections);
                
            } catch (error) {
                infoDiv.innerHTML = `<p style="color: red;">‚ùå Error accessing main site: ${error.message}</p>`;
                analysisDiv.innerHTML = `<p style="color: red;">Cannot analyze sections due to error.</p>`;
            }
        }
        
        function testContextualAnimation(section) {
            if (mainSiteWindow && mainSiteWindow.mascot && mainSiteWindow.mascot.triggerContextualAnimation) {
                mainSiteWindow.mascot.triggerContextualAnimation(section);
                console.log(`üß™ Manually triggered contextual animation: ${section}`);
            }
        }
        
        // Auto-load main site on page load
        window.addEventListener('load', () => {
            setTimeout(reloadMainSite, 500);
        });
    </script>
</body>
</html>
