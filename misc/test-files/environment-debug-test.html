<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Debug Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, sans-serif;
            background: #f5f5f5;
        }
        
        .debug-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: black;
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 3000;
            max-width: 400px;
            font-size: 12px;
        }
        
        .test-btn {
            margin: 5px;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background: #333;
            color: white;
            cursor: pointer;
        }
        
        .test-btn.active {
            background: #EBC533;
            color: black;
        }
        
        .debug-info {
            margin: 10px 0;
            font-family: monospace;
            background: #222;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
    <link rel="stylesheet" href="css/utilities/variables.css">
    <link rel="stylesheet" href="css/components/mascot.css">
    <link rel="stylesheet" href="css/components/mascot-environment.css">
</head>
<body>
    <div class="debug-panel">
        <h3>Environment Debug</h3>
        <div>
            <button class="test-btn" data-state="idle">Idle</button>
            <button class="test-btn" data-state="creating">Creating</button>
            <button class="test-btn" data-state="thinking">Thinking</button>
            <button class="test-btn" data-state="coffee">Coffee</button>
            <button class="test-btn" data-state="excited">Excited</button>
        </div>
        <div class="debug-info" id="debugInfo">
            Initializing...
        </div>
    </div>

    <script type="module">
        import { DesignerMascot } from './js/modules/mascot.js';
        
        let mascot = null;
        
        function updateDebugInfo() {
            const mascotEl = document.querySelector('.character-mascot');
            const envEl = document.querySelector('.mascot-environment');
            
            let info = 'DEBUG INFO:\n\n';
            
            if (mascotEl) {
                info += `âœ“ Mascot found\n`;
                info += `Classes: ${mascotEl.className}\n`;
            } else {
                info += `âœ— Mascot not found\n`;
            }
            
            if (envEl) {
                info += `âœ“ Environment found\n`;
                info += `Classes: ${envEl.className}\n`;
                
                // Check each state container
                const states = ['creating', 'thinking', 'coffee', 'excited', 'sleepy', 'dancing'];
                states.forEach(state => {
                    const container = envEl.querySelector(`.env-${state}`);
                    if (container) {
                        const style = getComputedStyle(container);
                        const display = style.display;
                        info += `${state}: ${display}\n`;
                        
                        if (display === 'block') {
                            const elements = container.querySelectorAll('.env-element');
                            let visibleCount = 0;
                            elements.forEach(el => {
                                const elStyle = getComputedStyle(el);
                                if (elStyle.opacity !== '0') visibleCount++;
                            });
                            info += `  visible elements: ${visibleCount}/${elements.length}\n`;
                        }
                    } else {
                        info += `${state}: container missing!\n`;
                    }
                });
            } else {
                info += `âœ— Environment not found\n`;
            }
            
            if (mascot) {
                info += `\nMascot state: ${mascot.currentState}\n`;
            }
            
            document.getElementById('debugInfo').textContent = info;
        }
        
        // Initialize mascot
        try {
            mascot = new DesignerMascot();
            console.log('ðŸŽ­ Debug test initialized');
            
            setTimeout(() => {
                updateDebugInfo();
                setInterval(updateDebugInfo, 1000);
            }, 1000);
        } catch (error) {
            console.error('Mascot error:', error);
            document.getElementById('debugInfo').textContent = `Error: ${error.message}`;
        }
        
        // Test buttons
        document.querySelectorAll('.test-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const state = btn.dataset.state;
                
                // Update active button
                document.querySelectorAll('.test-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (mascot) {
                    console.log(`Setting state to: ${state}`);
                    mascot.setState(state);
                    setTimeout(updateDebugInfo, 100);
                }
            });
        });
    </script>
</body>
</html>
