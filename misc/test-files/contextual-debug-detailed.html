<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contextual Animation Debug - Detailed</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
            line-height: 1.6;
        }
        
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 9999;
        }
        
        .debug-panel h3 {
            margin: 0 0 10px 0;
            color: #EBC533;
        }
        
        .debug-info {
            margin: 5px 0;
        }
        
        .debug-info.active {
            color: #EBC533;
            font-weight: bold;
        }
        
        section {
            min-height: 100vh;
            padding: 50px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        #home {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
        }
        
        #work {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
        }
        
        #about {
            background: linear-gradient(135deg, #e5e5e5 0%, #d5d5d5 100%);
        }
        
        #contact {
            background: linear-gradient(135deg, #dadada 0%, #cacaca 100%);
        }
        
        h1 {
            font-size: 3rem;
            margin: 0;
            color: #333;
        }
        
        p {
            font-size: 1.2rem;
            color: #666;
            text-align: center;
            max-width: 600px;
        }
        
        .nav-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .nav-link {
            display: inline-block;
            margin: 0 10px;
            padding: 8px 16px;
            background: #333;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        .nav-link:hover {
            background: #EBC533;
        }
        
        .test-buttons {
            position: fixed;
            bottom: 120px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-btn {
            padding: 8px 12px;
            background: #EBC533;
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .test-btn:hover {
            background: #D66422;
            color: white;
        }
    </style>
    
    <!-- Import CSS system -->
    <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
    <!-- Debug Panel -->
    <div class="debug-panel">
        <h3>ðŸŽ­ Contextual Debug</h3>
        <div class="debug-info" id="current-state">State: idle</div>
        <div class="debug-info" id="current-section">Section: none</div>
        <div class="debug-info" id="intersection-status">Observer: waiting...</div>
        <div class="debug-info" id="auto-cycle-status">Auto-cycle: active</div>
        <div class="debug-info" id="last-trigger">Last trigger: none</div>
        <div class="debug-info" id="section-count">Sections observed: 0</div>
        <div class="debug-info" id="nav-count">Nav links bound: 0</div>
    </div>
    
    <!-- Navigation -->
    <div class="nav-container">
        <a href="#home" class="nav-link">Home</a>
        <a href="#work" class="nav-link">Work</a>
        <a href="#about" class="nav-link">About</a>
        <a href="#contact" class="nav-link">Contact</a>
    </div>
    
    <!-- Test buttons -->
    <div class="test-buttons">
        <button class="test-btn" onclick="testManualTrigger('creating')">Test Creating</button>
        <button class="test-btn" onclick="testManualTrigger('coffee')">Test Coffee</button>
        <button class="test-btn" onclick="testManualTrigger('dancing')">Test Dancing</button>
        <button class="test-btn" onclick="testManualTrigger('excited')">Test Excited</button>
        <button class="test-btn" onclick="pauseAutoCycle()">Pause Auto-cycle</button>
        <button class="test-btn" onclick="resumeAutoCycle()">Resume Auto-cycle</button>
    </div>
    
    <!-- Sections -->
    <section id="home" class="hero-section">
        <h1>Hero / Home</h1>
        <p>This is the hero section. The mascot should show "creating" animation when this section is in view or when clicking the "Home" nav link.</p>
    </section>
    
    <section id="work" class="gallery-section">
        <h1>Work</h1>
        <p>This is the work section. The mascot should show "coffee" animation when this section is in view or when clicking the "Work" nav link.</p>
    </section>
    
    <section id="about" class="about-section">
        <h1>About</h1>
        <p>This is the about section. The mascot should show "dancing" animation when this section is in view or when clicking the "About" nav link.</p>
    </section>
    
    <section id="contact" class="contact-section">
        <h1>Contact</h1>
        <p>This is the contact section. The mascot should show "excited" animation when this section is in view or when clicking the "Contact" nav link.</p>
    </section>
    
    <script type="module">
        import { DesignerMascot } from '../../js/modules/mascot.js';
        
        // Global references for debugging
        let mascot;
        let autoCyclePaused = false;
        
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize mascot
            mascot = new DesignerMascot();
            
            // Make mascot globally accessible
            window.mascot = mascot;
            window.testManualTrigger = testManualTrigger;
            window.pauseAutoCycle = pauseAutoCycle;
            window.resumeAutoCycle = resumeAutoCycle;
            
            // Update debug info periodically
            setInterval(updateDebugInfo, 1000);
            
            // Monitor section visibility
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        document.getElementById('current-section').textContent = 
                            `Section: ${entry.target.id} (${(entry.intersectionRatio * 100).toFixed(1)}%)`;
                    }
                });
                
                document.getElementById('intersection-status').textContent = 
                    `Observer: ${entries.length} entries processed`;
            }, {
                threshold: [0.1, 0.3, 0.5, 0.7, 0.9]
            });
            
            // Observe all sections
            document.querySelectorAll('section').forEach(section => {
                observer.observe(section);
            });
        });
        
        function updateDebugInfo() {
            if (!mascot) return;
            
            document.getElementById('current-state').textContent = `State: ${mascot.currentState}`;
            document.getElementById('auto-cycle-status').textContent = 
                `Auto-cycle: ${autoCyclePaused ? 'PAUSED' : 'active'}`;
            
            // Count observed sections and nav links
            const sections = document.querySelectorAll('#home, #work, #about, #contact, .hero-section, .gallery-section, .about-section, .contact-section');
            const navLinks = document.querySelectorAll('.nav-link, .hero-cta, a[href^="#"]');
            
            document.getElementById('section-count').textContent = `Sections observed: ${sections.length}`;
            document.getElementById('nav-count').textContent = `Nav links bound: ${navLinks.length}`;
        }
        
        function testManualTrigger(animation) {
            if (!mascot) return;
            
            console.log(`ðŸ§ª Manual trigger: ${animation}`);
            document.getElementById('last-trigger').textContent = `Last trigger: ${animation} (manual)`;
            
            // Try calling the contextual animation directly
            if (typeof mascot.triggerContextualAnimation === 'function') {
                // Map animation to section
                const sectionMap = {
                    'creating': 'hero',
                    'coffee': 'work',
                    'dancing': 'about',
                    'excited': 'contact'
                };
                
                const section = sectionMap[animation] || animation;
                mascot.triggerContextualAnimation(section);
            } else {
                // Direct state change
                mascot.setState(animation);
            }
        }
        
        function pauseAutoCycle() {
            autoCyclePaused = true;
            console.log('ðŸ§ª Auto-cycle paused for testing');
            
            // Try to stop the auto-cycle intervals (hack for testing)
            if (mascot && mascot.autoCycleInterval) {
                clearInterval(mascot.autoCycleInterval);
            }
        }
        
        function resumeAutoCycle() {
            autoCyclePaused = false;
            console.log('ðŸ§ª Auto-cycle resumed');
            
            if (mascot && typeof mascot.resumeAutoCycle === 'function') {
                mascot.resumeAutoCycle();
            }
        }
        
        // Monitor navigation clicks
        document.addEventListener('click', (e) => {
            if (e.target.matches('.nav-link')) {
                const href = e.target.getAttribute('href');
                document.getElementById('last-trigger').textContent = 
                    `Last trigger: ${href} (nav click)`;
            }
        });
        
        // Log all mascot state changes
        const originalSetState = mascot?.setState;
        if (originalSetState) {
            mascot.setState = function(newState, immediate) {
                console.log(`ðŸŽ­ setState called: ${this.currentState} â†’ ${newState} (immediate: ${immediate})`);
                document.getElementById('last-trigger').textContent = 
                    `Last trigger: ${newState} (setState)`;
                return originalSetState.call(this, newState, immediate);
            };
        }
    </script>
</body>
</html>
